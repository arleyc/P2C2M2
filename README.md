
<!-- README.md is generated from README.Rmd. Please edit that file -->

# P2C2M2

<!-- badges: start -->
<!-- badges: end -->

P2C2M2 provides functions to read default output from BEAST2 (….) and
starBEAST2 (….) and conduct posterior predictive checks of coalescent
models (Reid et al. 2014) based on the functions originally provided in
the P2C2M package (Gruenstaeudl et al. 2016) to parse tree and xml files
from BEAST and \*BEAST. It also implements estimation of type-I
(false-positive) error rates using pseudo-observed datasets (“pods”)
sampled from the posterior predictive distribution.

## Installation

You can install the development version of P2C2M2 from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("arleyc/P2C2M2")
```

## Input files

In order to generate the tree files annotated with the required
demographic and branch rate estimates, the XML file has to be modified
by hand to include the following code before running BEAST 2:

\#For strict clocks:

Insert the following: <em>substitutions=“true”
branchratemodel=“@StrictClock.c:Locus_Name”</em> after
<em>id=“TreeWithMetaDataLogger.t:Locus_Name”</em> and before
<em>spec=“beast.base.evolution.TreeWithMetaDataLogger”</em>

\#For UCLN or RLC clocks:

Insert the following: <em>substitutions=“true”</em> after
<em>id=“TreeWithMetaDataLogger.t:Locus_Name”</em> and before
<em>spec=“beast.base.evolution.TreeWithMetaDataLogger”</em>

## Example

Basic example showing how to run the full pipeline with a single
function using the provided dataset to test the multispecies coalescent
model and to estimate false positive error rates per locus and across
loci:

``` r
library(P2C2M2)

# The absolute path to the input directory is set
inPath <- system.file("extdata", "thomomys/", package="P2C2M2")

# The name of the xml-file generated by BEAUTi and located in 
# "inPath" is set
inFile <- "thomomys.xml"

# Posterior predictive simulations with a setting of 2 simulation 
# replicates are preformed
suppressWarnings(thomomys <- p2c2m2.complete(inPath, inFile, num.reps=2, error.rate = TRUE))
#> 
#> bindings, loci, and alignments read
#> 
#> locus 26 is done
#> 
#> locus 29 is done
#> 
#> locus 47 is done
#> 
#> locus 53 is done
#> 
#> locus 59 is done
#> 
#> locus 64 is done
#> 
#> locus 72 is done
#> 
#> gene trees done
#> 
#> species trees done
#> 
#> Calculating metrics for 3 trees of the posterior distribution
#> 
#> Calculating metrics for the trees of the post. predictive distribution
#> 
#> Calculating differences btw. the posterior and the post. predictive distribution
#> 
#> Calculating differences btw. 1000 pods and the post. predictive distribution to estimate error rates

thomomys$results$alpha0.01
#> $perGene
#>    LCWT[2]                NDC[2]              
#> 26 "-1.7 (±39.03) n.s."   "-1.33 (±9.07) n.s."
#> 29 "-8.47 (±11.28) n.s."  "-3.67 (±3.21) *"   
#> 47 "9.26 (±8.84) n.s."    "2 (±6) n.s."       
#> 53 "-21.28 (±19.16) n.s." "5.33 (±2.31) *"    
#> 59 "2.35 (±35.31) n.s."   "-3 (±5.29) n.s."   
#> 64 "-19.49 (±8.96) *"     "9.67 (±9.45) n.s." 
#> 72 "29.94 (±39.3) n.s."   "-12.33 (±6.03) *"  
#> 
#> $acrGenes
#>        LCWT[2]                NDC[2]               
#> Sum    "12.77 (±124.38) n.s." "-5 (±9.78) n.s."    
#> Mean   "1.82 (±17.77) n.s."   "-0.71 (±1.4) n.s."  
#> Median "-4.54 (±20.37) n.s."  "0 (±8) n.s."        
#> Mode   "20.82 (±30.37) n.s."  "-2.14 (±12.24) n.s."
#> CV     "-0.29 (±1.66) n.s."   "-8.54 (±16.94) n.s."
#> 
#> $perGene.error
#>    LCWT[2] NDC[2]
#> 26   0.666  1.000
#> 29   0.672  0.647
#> 47   0.672  0.647
#> 53   0.662  1.000
#> 59   0.672  0.673
#> 64   0.666  0.673
#> 72   0.672  0.673
#> 
#> $acrGenes.error
#>        LCWT[2] NDC[2]
#> Sum      0.662  0.647
#> Mean     0.662  0.647
#> Median   0.000  0.000
#> Mode     0.000  0.000
#> CV       0.662  0.647

thomomys$results$legend
#> [1] "Differences between the posterior and the posterior predictive distributions per locus and across loci. Each cell contains the following information in said order: mean, standard deviation, significance level. Error rates (if estimated with option error.rate=TRUE) are based on differences between the pods and the posterior predictive distributions. Codes in square brackets indicate the number of tails. Alpha values are automatically adjusted for the number of tails."
```

## References

Beast2

StarBeast2

Reid, N.M., Brown, J.M., Satler, J.D., Pelletier, T.A., McVay, J.D.,
Hird, S.M. and Carstens, B.C. (2014) Poor fit to the multi-species
coalescent model is widely detectable in empirical data. Systematic
Biology, 63, 322–333.

Gruenstaeudl, M., Reid, N.M., Wheeler, G.R. and Carstens, B.C. (2016)
Posterior predictive checks of coalescent nodels: P2C2M, an R package.
Molecular Ecology Resources, 6, 193–205. doi: 10.1111/1755-0998.12435

## Citation

Villamil, J. et al. in review.
