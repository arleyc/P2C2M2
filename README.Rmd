---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# P2C2M2

<!-- badges: start -->
<!-- badges: end -->

P2C2M2 provides functions to read default output from BEAST 2 (Bouckaert et al. 2019) and StarBEAST2 (Ogilvie et al. 2017) and conduct posterior predictive checks of coalescent models (Reid et al. 2014) based on the functions originally provided in the P2C2M package (Gruenstaeudl et al. 2016) to parse tree and xml files from BEAST and *BEAST. It also implements estimation of type-I (false-positive) error rates using pseudo-observed datasets ("pods") sampled from the posterior predictive distribution.

## Installation

You can install the development version of P2C2M2 from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("arleyc/P2C2M2")
```

## Input files

In order to generate the tree files annotated with the required branch rate estimates, the XML file has to be modified by hand to include the following code before running BEAST 2:

#For strict clocks:

Insert the following:<br>
<em>substitutions="true" branchratemodel="\@StrictClock.c:Locus_Name"</em><br>
after <em>id="TreeWithMetaDataLogger.t:Locus_Name"</em> and before <em>spec="beast.base.evolution.TreeWithMetaDataLogger"</em>

#For UCLN or RLC clocks:

Insert the following:<br>
<em>substitutions="true"</em><br>
after <em>id="TreeWithMetaDataLogger.t:Locus_Name"</em> and before <em>spec="beast.base.evolution.TreeWithMetaDataLogger"</em>

## Example

Basic example showing how to run the full pipeline with a single function using the provided dataset to test the multispecies coalescent model and to estimate false positive error rates per locus and across loci:

```{r example}
library(P2C2M2)

# The absolute path to the input directory is set
inPath <- system.file("extdata", "thomomys/", package="P2C2M2")

# The name of the xml-file generated by BEAUTi and located in 
# "inPath" is set
inFile <- "thomomys.xml"

# Posterior predictive simulations with a setting of 2 simulation 
# replicates are preformed
suppressWarnings(thomomys <- p2c2m2.complete(inPath, inFile, num.reps=2, error.rate = TRUE))

thomomys$results$alpha0.01

thomomys$results$legend
```

## References

Bouckaert, R., Vaughan, T.G., Barido-Sottani, J., Duchêne, S., Fourment, M., Gavryushkina, A., et al. (2019) BEAST 2.5: An advanced software platform for Bayesian evolutionary analysis. PLoS Computational Biology, 15(4), e1006650.

Ogilvie, H.A., Bouckaert, R.R., Drummond, A.J. (2017) StarBEAST2 brings faster species tree inference and accurate estimates of substitution rates. Molecular Biology and Evolution, 34(8), 2101-–2114.

Gruenstaeudl, M., Reid, N.M., Wheeler, G.R. and Carstens, B.C. (2016) Posterior predictive checks of coalescent nodels: P2C2M, an R package. Molecular Ecology Resources, 6, 193--205.

Reid, N.M., Brown, J.M., Satler, J.D., Pelletier, T.A., McVay, J.D., Hird, S.M. and Carstens, B.C. (2014) Poor fit to the multi-species coalescent model is widely detectable in empirical data. Systematic Biology, 63, 322--333.

## Citation

Villamil, J., Morando, M., Avila, L.J., Lanna, F.M., Fonseca, E.M., Sites, Jr., J.W., Camargo, A. Revisiting the problem of Multispecies Coalescent Model fit with an example from the first complete molecular phylogeny of the <em>Liolaemus wiegmannii</em> species group (Squamata: Liolaemidae), in review.
